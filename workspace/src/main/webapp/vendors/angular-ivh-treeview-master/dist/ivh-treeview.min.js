angular.module("ivh.treeview",[]),angular.module("ivh.treeview").constant("ivhTreeviewInterpolateEndSymbol","}}"),angular.module("ivh.treeview").constant("ivhTreeviewInterpolateStartSymbol","{{"),angular.module("ivh.treeview").directive("ivhTreeviewCheckboxHelper",[function(){"use strict";return{restrict:"A",scope:{node:"=ivhTreeviewCheckboxHelper"},require:"^ivhTreeview",link:function(e,t,i,n){var r=e.node,l=n.opts(),o=l.indeterminateAttribute,a=l.selectedAttribute;e.isSelected=r[a],e.trvw=n,e.resolveIndeterminateClick=function(){l.disableCheckboxSelectionPropagation||r[o]&&n.select(r,!0)},e.$watch("node."+a,function(t,i){e.isSelected=t}),l.disableCheckboxSelectionPropagation||e.$watch("node."+o,function(e,i){t.find("input").prop("indeterminate",e)})},template:['<input type="checkbox"','class="ivh-treeview-checkbox"','ng-model="isSelected"','ng-click="resolveIndeterminateClick()"','ng-change="trvw.select(node, isSelected)" />'].join("\n")}}]),angular.module("ivh.treeview").directive("ivhTreeviewCheckbox",[function(){"use strict";return{restrict:"AE",require:"^ivhTreeview",template:'<span ivh-treeview-checkbox-helper="node"></span>'}}]),angular.module("ivh.treeview").directive("ivhTreeviewChildren",function(){"use strict";return{restrict:"AE",require:"^ivhTreeviewNode",template:['<ul ng-if="getChildren().length" class="ivh-treeview">','<li ng-repeat="child in getChildren()"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"','class="ivh-treeview-node"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node="child"','ivh-treeview-depth="childDepth">',"</li>","</ul>"].join("\n")}}),angular.module("ivh.treeview").directive("ivhTreeviewNode",["ivhTreeviewCompiler",function(e){"use strict";return{restrict:"A",scope:{node:"=ivhTreeviewNode",depth:"=ivhTreeviewDepth"},require:"^ivhTreeview",compile:function(t){return e.compile(t,function(e,t,i,n){var r=e.node,l=e.getChildren=function(){return n.children(r)};e.trvw=n,e.childDepth=e.depth+1,n.isExpanded(r)||n.expand(r,n.isInitiallyExpanded(e.depth)),e.$watch(function(){return l().length>0},function(e){e?t.removeClass("ivh-treeview-node-leaf"):t.addClass("ivh-treeview-node-leaf")})})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewToggle",[function(){"use strict";return{restrict:"A",require:"^ivhTreeview",link:function(e,t,i,n){var r=e.node;t.addClass("ivh-treeview-toggle"),t.bind("click",function(){n.isLeaf(r)||e.$apply(function(){n.toggleExpanded(r),n.onToggle(r)})})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewTwistie",["$compile","ivhTreeviewOptions",function(e,t){"use strict";var i=t();return{restrict:"A",require:"^ivhTreeview",template:['<span class="ivh-treeview-twistie">','<span class="ivh-treeview-twistie-collapsed">',i.twistieCollapsedTpl,"</span>",'<span class="ivh-treeview-twistie-expanded">',i.twistieExpandedTpl,"</span>",'<span class="ivh-treeview-twistie-leaf">',i.twistieLeafTpl,"</span>","</span>"].join("\n"),link:function(t,n,r,l){if(l.hasLocalTwistieTpls){var o=l.opts(),a=n.children().eq(0).children();angular.forEach(["twistieCollapsedTpl","twistieExpandedTpl","twistieLeafTpl"],function(n,r){var l=o[n],s=i[n];if(l&&l!==s){"<"===l.substr(0,1)&&">"===l.substr(-1,1)||(l="<span>"+l+"</span>");var c=e(l)(t);a.eq(r).html("").append(c)}})}}}}]),angular.module("ivh.treeview").directive("ivhTreeview",["ivhTreeviewMgr",function(e){"use strict";return{restrict:"A",transclude:!0,scope:{root:"=ivhTreeview",childrenAttribute:"=ivhTreeviewChildrenAttribute",defaultSelectedState:"=ivhTreeviewDefaultSelectedState",disableCheckboxSelectionPropagation:"=ivhTreeviewDisableCheckboxSelectionPropagation",expandToDepth:"=ivhTreeviewExpandToDepth",idAttribute:"=ivhTreeviewIdAttribute",indeterminateAttribute:"=ivhTreeviewIndeterminateAttribute",expandedAttribute:"=ivhTreeviewExpandedAttribute",labelAttribute:"=ivhTreeviewLabelAttribute",nodeTpl:"=ivhTreeviewNodeTpl",selectedAttribute:"=ivhTreeviewSelectedAttribute",onCbChange:"&ivhTreeviewOnCbChange",onToggle:"&ivhTreeviewOnToggle",twistieCollapsedTpl:"=ivhTreeviewTwistieCollapsedTpl",twistieExpandedTpl:"=ivhTreeviewTwistieExpandedTpl",twistieLeafTpl:"=ivhTreeviewTwistieLeafTpl",useCheckboxes:"=ivhTreeviewUseCheckboxes",validate:"=ivhTreeviewValidate",visibleAttribute:"=ivhTreeviewVisibleAttribute",userOptions:"=ivhTreeviewOptions",filter:"=ivhTreeviewFilter"},controllerAs:"trvw",controller:["$scope","$element","$attrs","$transclude","ivhTreeviewOptions","filterFilter",function(t,i,n,r,l,o){var a=angular,s=this,c=a.extend({},l(),t.userOptions);a.forEach(["childrenAttribute","defaultSelectedState","disableCheckboxSelectionPropagation","expandToDepth","idAttribute","indeterminateAttribute","expandedAttribute","labelAttribute","nodeTpl","selectedAttribute","twistieCollapsedTpl","twistieExpandedTpl","twistieLeafTpl","useCheckboxes","validate","visibleAttribute"],function(e){a.isDefined(t[e])&&(c[e]=t[e])});var u=function(e){return"ivhTreeview"+e.charAt(0).toUpperCase()+e.slice(1)};a.forEach(["onCbChange","onToggle"],function(e){n[u(e)]&&(c[e]=t[e])});var d;r(function(e,t){var i="";angular.forEach(e,function(e){i+=(e.innerHTML||"").trim()}),i.length&&(d=t,c.nodeTpl=i)}),s.opts=function(){return c};var v=t.userOptions||{};s.hasLocalTwistieTpls=!!(v.twistieCollapsedTpl||v.twistieExpandedTpl||v.twistieLeafTpl||t.twistieCollapsedTpl||t.twistieExpandedTpl||t.twistieLeafTpl),s.children=function(e){var t=e[c.childrenAttribute];return a.isArray(t)?t:[]},s.label=function(e){return e[c.labelAttribute]},s.hasFilter=function(){return a.isDefined(t.filter)},s.getFilter=function(){return t.filter||""},s.isVisible=function(e){var t=s.getFilter();if(!t||o([e],t).length)return!0;if("object"==typeof t||"function"==typeof t)for(var i=s.children(e),n=i.length;n--;)if(s.isVisible(i[n]))return!0;return!1},s.useCheckboxes=function(){return c.useCheckboxes},s.select=function(i,n){e.select(t.root,i,c,n),s.onCbChange(i,n)},s.isSelected=function(e){return e[c.selectedAttribute]},s.toggleSelected=function(e){var t=!e[c.selectedAttribute];s.select(e,t)},s.expand=function(i,n){e.expand(t.root,i,c,n)},s.isExpanded=function(e){return e[c.expandedAttribute]},s.toggleExpanded=function(e){s.expand(e,!s.isExpanded(e))},s.isInitiallyExpanded=function(e){return e<(-1===c.expandToDepth?1/0:c.expandToDepth)},s.isLeaf=function(e){return 0===s.children(e).length},s.getNodeTpl=function(){return c.nodeTpl},s.root=function(){return t.root},s.onToggle=function(e){if(c.onToggle){var i={ivhNode:e,ivhIsExpanded:s.isExpanded(e),ivhTree:t.root};c.onToggle(i)}},s.onCbChange=function(e,i){if(c.onCbChange){var n={ivhNode:e,ivhIsSelected:i,ivhTree:t.root};c.onCbChange(n)}}}],link:function(t,i,n){var r=t.trvw.opts();r.validate&&e.validate(t.root,r)},template:['<ul class="ivh-treeview">','<li ng-repeat="child in root | ivhTreeviewAsArray"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"','class="ivh-treeview-node"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node="child"','ivh-treeview-depth="0">',"</li>","</ul>"].join("\n")}}]),angular.module("ivh.treeview").filter("ivhTreeviewAsArray",function(){"use strict";return function(e){return!angular.isArray(e)&&angular.isObject(e)?[e]:e}}),angular.module("ivh.treeview").factory("ivhTreeviewBfs",["ivhTreeviewOptions",function(e){"use strict";var t=angular;return function(i,n,r){2===arguments.length&&t.isFunction(n)&&(r=n,n={}),n=angular.extend({},e(),n),r=r||t.noop;var l,o,a,s,c,u=[],d=n.childrenAttribute;for(t.isArray(i)?(t.forEach(i,function(e){u.push([e,[]])}),l=u.shift()):l=[i,[]];l;){if(o=l[0],a=l[1],!1!==r(o,a)&&o[d]&&t.isArray(o[d]))for(c=o[d].length,s=0;s<c;s++)u.push([o[d][s],[o].concat(a)]);l=u.shift()}}}]),angular.module("ivh.treeview").factory("ivhTreeviewCompiler",["$compile",function(e){"use strict";return{compile:function(t,i){angular.isFunction(i)&&(i={post:i});var n;return{pre:i&&i.pre?i.pre:null,post:function(t,r,l,o){n||(n=e(o.getNodeTpl())),n(t,function(e){r.append(e)}),i&&i.post&&i.post.apply(null,arguments)}}}}}]),angular.module("ivh.treeview").factory("ivhTreeviewMgr",["ivhTreeviewOptions","ivhTreeviewBfs",function(e,t){"use strict";var i=angular,n=e(),r={},l=function(e){e[this.selectedAttribute]=!1,e[this.indeterminateAttribute]=!1},o=function(e){e[this.selectedAttribute]=!0,e[this.indeterminateAttribute]=!1},a=function(e){var t=e[this.childrenAttribute],n=this.selectedAttribute,r=this.indeterminateAttribute,l=0,o=0;i.forEach(t,function(e,t){e[n]?l++:e[r]&&o++}),0===l&&0===o?(e[n]=!1,e[r]=!1):l===t.length?(e[n]=!0,e[r]=!1):(e[n]=!1,e[r]=!0)},s=function(e){return i.isString(e)||i.isNumber(e)},c=function(e,i,n,r){var l=s(i),o=!0,a=n.idAttribute,c=null,u=[];return t(e,n,function(e,t){return o&&(l?i===e[a]:i===e)&&(o=!1,c=e,u=t),o}),r(c,u)};return r.select=function(e,c,u,d){arguments.length>2&&"boolean"==typeof u&&(d=u,u={}),u=i.extend({},n,u),d=!i.isDefined(d)||d;var v=s(c),h=!0,p=u.idAttribute;return t(e,u,function(e,n){if(h&&(v?c===e[p]:c===e)){h=!1;var r=d?o.bind(u):l.bind(u);u.disableCheckboxSelectionPropagation?r(e):(t(e,u,r),i.forEach(n,a.bind(u)))}return h}),r},r.selectAll=function(e,l,o){arguments.length>1&&"boolean"==typeof l&&(o=l,l={}),l=i.extend({},n,l),o=!i.isDefined(o)||o;var a=l.selectedAttribute,s=l.indeterminateAttribute;return t(e,l,function(e){e[a]=o,e[s]=!1}),r},r.selectEach=function(e,t,n,l){return i.forEach(t,function(t){r.select(e,t,n,l)}),r},r.deselect=function(e,t,i){return r.select(e,t,i,!1)},r.deselectAll=function(e,t){return r.selectAll(e,t,!1)},r.deselectEach=function(e,t,i){return r.selectEach(e,t,i,!1)},r.validate=function(e,l,o){if(!e)return r;arguments.length>1&&"boolean"==typeof l&&(o=l,l={}),l=i.extend({},n,l),o=i.isDefined(o)?o:l.defaultSelectedState;var a=l.selectedAttribute,s=l.indeterminateAttribute;return t(e,l,function(t,n){if(i.isDefined(t[a])&&t[a]!==o)return r.select(e,t,l,!o),!1;t[a]=o,t[s]=!1}),r},r.expand=function(e,t,l,o){arguments.length>2&&"boolean"==typeof l&&(o=l,l={}),l=i.extend({},n,l),o=!i.isDefined(o)||o;var a=s(t),u=l.expandedAttribute;return a?c(e,t,l,function(e,t){return e[u]=o,r}):(t[u]=o,r)},r.expandRecursive=function(e,l,o,a){arguments.length>2&&"boolean"==typeof o&&(a=o,o={}),l=i.isDefined(l)?l:e,o=i.extend({},n,o),a=!i.isDefined(a)||a;var u,d=s(l),v=o.expandedAttribute;return d?c(e,l,o,function(e,t){u=e}):u=l,u&&t(u,o,function(e,t){e[v]=a}),r},r.collapse=function(e,t,i){return r.expand(e,t,i,!1)},r.collapseRecursive=function(e,t,i,n){return r.expandRecursive(e,t,i,!1)},r.expandTo=function(e,t,l,o){arguments.length>2&&"boolean"==typeof l&&(o=l,l={}),l=i.extend({},n,l),o=!i.isDefined(o)||o;var a=l.expandedAttribute,s=function(e){e[a]=o};return c(e,t,l,function(e,t){return i.forEach(t,s),r})},r.collapseParents=function(e,t,i){return r.expandTo(e,t,i,!1)},r}]),angular.module("ivh.treeview").provider("ivhTreeviewOptions",["ivhTreeviewInterpolateStartSymbol","ivhTreeviewInterpolateEndSymbol",function(e,t){"use strict";var i=e,n=t,r={idAttribute:"id",labelAttribute:"label",childrenAttribute:"children",selectedAttribute:"selected",expandToDepth:0,useCheckboxes:!0,disableCheckboxSelectionPropagation:!1,validate:!0,indeterminateAttribute:"__ivhTreeviewIndeterminate",expandedAttribute:"__ivhTreeviewExpanded",defaultSelectedState:!0,twistieExpandedTpl:"(-)",twistieCollapsedTpl:"(+)",twistieLeafTpl:"o",nodeTpl:['<div class="ivh-treeview-node-content" title="{{trvw.label(node)}}">',"<span ivh-treeview-toggle>",'<span class="ivh-treeview-twistie-wrapper" ivh-treeview-twistie></span>',"</span>",'<span class="ivh-treeview-checkbox-wrapper" ng-if="trvw.useCheckboxes()"',"ivh-treeview-checkbox>","</span>",'<span class="ivh-treeview-node-label" ivh-treeview-toggle>',"{{trvw.label(node)}}","</span>","<div ivh-treeview-children></div>","</div>"].join("\n").replace(new RegExp("{{","g"),i).replace(new RegExp("}}","g"),n)};this.set=function(e){angular.extend(r,e)},this.$get=function(){return function(){return angular.copy(r)}}}]);